server:
  port: 8081
  compression:
    enabled: true
  servlet:
    encoding:
      enabled: true
      charset: UTF-8
      force: true
    context-path: /

spring:
  application:
    name: yoda-main
  
  profiles:
    active: local

  messages:
    basename: messages/messages
    encoding: UTF-8
  banner:
    charset: UTF-8
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/yoda?serverTimezone=UTC&useUnicode=true&characterEncoding=utf-8&useSSL=false&allowPublicKeyRetrieval=true
    username: root
    password: 
  data:
    redis:
      host: localhost
      port: 6379
      password: 
      database: 0
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms
  
  cloud:
    loadbalancer:
      ribbon:
        enabled: false
      retry:
        enabled: true
        max-attempts: 3
        initial-interval: 1000
        multiplier: 1.1
        max-interval: 2000
    
    circuitbreaker:
      resilience4j:
        instances:
          yoda-content-service:
            registerHealthIndicator: true
            slidingWindowSize: 10
            minimumNumberOfCalls: 1
            permittedNumberOfCallsInHalfOpenState: 3
            waitDurationInOpenState: 60s
            failureRateThreshold: 50
            eventConsumerBufferSize: 10
            recordExceptions:
              - java.lang.Exception
              - java.lang.RuntimeException
            ignoreExceptions:
              - java.util.concurrent.TimeoutException
    
    openfeign:
      circuitbreaker:
        enabled: true

# Feign fallback support
feign:
  circuitbreaker:
    enabled: true

# Resilience4j configuration
# resilience4j:
#   circuitbreaker:
#     instances:
#       yoda-content-service:
#         failure-rate-threshold: 50
#         wait-duration-in-open-state: 60s
#         sliding-window-size: 10
#         minimum-number-of-calls: 1
#         permitted-number-of-calls-in-half-open-state: 3
#         record-exceptions:
#           - java.lang.Exception
#           - java.lang.RuntimeException
#           - java.net.ConnectException
#           - java.net.SocketException
#           - feign.FeignException
#         ignore-exceptions:
#           - java.util.concurrent.TimeoutException

mybatis-plus:
  lazy-loading-enabled: true
  configuration:
    aggressive-lazy-loading: false
    auto-mapping-behavior: partial
    map-underscore-to-camel-case: true
    local-cache-scope: statement
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    cache-enabled: false
    call-setters-on-nulls: true
    jdbc-type-for-null: 'null'
  executor-type: simple
  global-config:
    db-config:
      id-type: ASSIGN_ID
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
    banner: false
  mapper-locations: classpath*:mapper/*.xml
  type-aliases-package: com.taklip.yoda.model
  type-aliases-super-type: com.taklip.yoda.model.BaseEntity

app:
  id: ${spring.application.name}

wx:
  appID: wx1234567890
  token: 1234567890
  encodingAESKey: 1234567890

yoda:
  file-location: ${HOME}/yoda/uploads/
  mq-enabled: false

# Management endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,circuitbreakers
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# Logging
logging:
  level:
    com.taklip.yoda: DEBUG
    com.taklip.yoda.client: DEBUG
    org.springframework.cloud.openfeign: DEBUG
    org.springframework.web: DEBUG
    com.baomidou.mybatisplus: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# OpenAPI Configuration
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui-custom.html
    operations-sorter: method
  info:
    title: Yoda Main Application API
    description: Main Yoda CMS application with content service integration
    version: 1.0.0
    contact:
      name: Yoda Development Team
      email: dev@yoda.com

# JWT Configuration
jwt:
  secret: ${JWT_SECRET:UOZMrwrzPZf6eOWPj+PZo/Z5ETNzm2JEZclee1ab0jU=}
  expiration: 86400000  # 24 hours in milliseconds
  refresh-token:
    expiration: 604800000  # 7 days in milliseconds